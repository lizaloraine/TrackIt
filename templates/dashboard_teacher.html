<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Teacher Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard_teacher.css') }}">
</head>
<body>

<!-- TOP HEADER -->
<header class="header-bar">
  <button id="menuToggle" class="burger-btn">
    <span></span><span></span><span></span>
  </button>

  <div class="header-right">
    <div class="user-icon"></div>
    <a href="{{ url_for('logout') }}" class="logout-link">Logout</a>
  </div>
</header>

<!-- SIDEBAR -->
<aside id="sidebar" class="sidebar">
  <h2 id="sidebarTitle" class="sidebar-title">TrackIt</h2>

  <nav class="sidebar-menu">
  <a href="{{ url_for('dashboard') }}" class="side-link active">Home</a>
  <a href="/dashboard/teacher/classes" class="side-link">Classes</a>
  <a href="#" class="side-link" id="addClassSidebarBtn">Add Class</a>
  <a href="{{ url_for('logout') }}" class="side-link">Logout</a>
</nav>
</aside>

<!-- MAIN CONTENT -->
<main class="teacher-dashboard">

  <h1 class="welcome">Welcome, {{ user.name }}!</h1>

  <div class="card">
    <h2 class="card-title">List of Managed Classes</h2>

    <table class="class-table">
  <thead>
    <tr>
      <th>Class Code</th>
      <th>Section</th>
      <th>Students</th>
    </tr>
  </thead>

  <tbody>
    {% for c in classes %}
    <tr>
      <td>{{ c.class_code or '' }}</td>
      <td>{{ c.section or '' }}</td>
      <td>{{ c.student_count or 0 }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
  </div>

</main>

 <!-- ADD CLASS MODAL -->
  <div id="addClassModal" class="modal">
    <div class="modal-content">

      <div class="modal-header">
        <h3>Add Class</h3>
        <span id="closeModal" class="close">&times;</span>
      </div>

      <div class="modal-body">
        <form id="addClassForm" method="POST" action="{{ url_for('dashboard') }}">
          
          <input type="hidden" name="action" value="add_class">

          <input 
            type="text" 
            id="class_code" 
            name="class_code" 
            placeholder="Enter Class Code" 
            required
          >

          <select id="section" name="section" required>
            <option value="">-- Select Section --</option>
          </select>

          <button type="submit" class="join-btn">Join Class</button>
        </form>
      </div>

    </div>
  </div>










<script>
const sidebar = document.getElementById("sidebar");
const toggle = document.getElementById("menuToggle");
const title = document.getElementById("sidebarTitle");

// Toggle open / close
toggle.addEventListener("click", () => {
  sidebar.classList.toggle("open");
});

// Close when clicking "TrackIt"
title.addEventListener("click", () => {
  sidebar.classList.remove("open");
});

// Close when clicking outside sidebar
document.addEventListener("click", (e) => {
  if (!sidebar.contains(e.target) && !toggle.contains(e.target)) {
    sidebar.classList.remove("open");
  }
});




/* -----------------------------
       MODAL
    ------------------------------*/
    const modal = document.getElementById("addClassModal");
    const openModalButtons = [
      document.getElementById("addClassBtn"),
      document.getElementById("addClassSidebarBtn")
    ];
    const closeModal = document.getElementById("closeModal");

    openModalButtons.forEach(btn => {
      if (btn) btn.onclick = () => modal.style.display = "flex";
    });

    closeModal.onclick = () => modal.style.display = "none";

    window.onclick = (e) => {
      if (e.target === modal) modal.style.display = "none";
    };


    /* -----------------------------
       DYNAMIC SECTION DROPDOWN
    ------------------------------*/
    const classInput = document.getElementById("class_code");
    const sectionSelect = document.getElementById("section");

    classInput.addEventListener("input", async () => {
      const code = classInput.value.trim().toUpperCase();

      if (!code) {
        sectionSelect.innerHTML = `<option value="">-- Select Section --</option>`;
        return;
      }

      sectionSelect.innerHTML = `<option value="">Loading...</option>`;

      try {
        const response = await fetch(`/get_sections/${code}`);
        if (!response.ok) {
          sectionSelect.innerHTML = `<option value="">No sections found</option>`;
          return;
        }

        const data = await response.json();
        const sections = data.sections;

        if (!sections || !sections.length) {
          sectionSelect.innerHTML = `<option value="">No sections found</option>`;
          return;
        }

        sectionSelect.innerHTML = `<option value="">-- Select Section --</option>`;
        sections.forEach(sec => {
          sectionSelect.innerHTML += `<option value="${sec}">${sec}</option>`;
        });

      } catch (err) {
        sectionSelect.innerHTML = `<option value="">Error loading</option>`;
      }
    });

</script>

</body>
</html>
