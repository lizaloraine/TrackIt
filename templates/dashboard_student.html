{% extends "base.html" %}
{% set auth_page = True %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard_student.css') }}">
{% endblock %}

{% block content %}
<nav class="navbar">
    <div class="nav-left">
        <strong>TrackIt</strong>
    </div>
    <div class="nav-right">
        <a href="{{ url_for('profile') }}">{{ user.name }}</a>
        <a href="{{ url_for('logout') }}">Logout</a>
    </div>
</nav>

<main class="student-dashboard">

    <!-- LEFT COLUMN -->
    <section class="left-col">

        <!-- JOIN BUTTON -->
        <button class="join-btn" id="join-class-btn">Join Class</button>

        <!-- Notifications -->
        <div class="panel notifications-panel">
            <div class="panel-header">
                <h3>Notifications</h3>
                <button id="mark-read" class="action-btn">Mark all read</button>
            </div>
            <div id="notifications-list" class="notifications-list">
                <div class="skeleton-item"></div>
                <div class="skeleton-item"></div>
            </div>
        </div>

        <!-- Search + Filters -->
        <div class="panel filter-panel">
            <input id="search-classes" placeholder="Search classes...">

            <div class="filters">
                <select id="filter-status">
                    <option value="">All</option>
                    <option value="low-attendance">Low Attendance (&lt;60%)</option>
                    <option value="high-absent">High Absent</option>
                </select>

                <select id="sort-classes">
                    <option value="alpha">Sort: A–Z</option>
                    <option value="most-absent">Most Absent</option>
                    <option value="attendance-desc">Best Attendance</option>
                </select>
            </div>
        </div>

        <!-- Classes -->
        <div id="classes-cards" class="classes-cards">

            {% if classes and classes|length > 0 %}
                {% for c in classes %}
                <div class="class-card"
                     data-class-id="{{ c.class_code }}"
                     data-class-name="{{ c.subjectName }}"
                     data-section="{{ c.section }}"
                     data-teacher="{{ c.teacher_name if c.teacher_name is defined else '' }}">
                    <div class="card-top">
                        <div>
                            <div class="subject">{{ c.subjectName }}</div>
                            <div class="section">{{ c.section }}</div>
                        </div>
                        <div class="stat">T: {{ c.teacher_name if c.teacher_name is defined else '-' }}</div>
                    </div>
                    <div class="card-bottom">
                        <p class="muted small">Click to view details</p>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p class="muted no-classes">You haven't joined any classes yet.</p>
            {% endif %}

        </div>

    </section>

    <!-- RIGHT COLUMN -->
    <aside class="right-col">

        <!-- Attendance Summary -->
        <div class="panel attendance-analytics">
            <div class="panel-header"><h3>Attendance Summary</h3></div>
            <canvas id="attendanceChart"></canvas>
            <div id="attendance-stats" class="attendance-stats"></div>
        </div>

        <!-- Class Details -->
        <div class="panel class-detail-panel">
            <div class="panel-header"><h3>Class Details</h3></div>
            <div id="class-detail-content">
                <p class="muted">Select a class card to view details (attendance calendar, topics, download report).</p>
            </div>
        </div>

    </aside>

</main>

<!-- JOIN CLASS MODAL -->
<div class="modal-bg" id="modal-bg">
  <div class="modal-box" role="dialog" aria-modal="true" aria-labelledby="join-title">
    <h2 id="join-title">Join a Class</h2>

    <label for="class-code-input">Class Code</label>
    <input type="text" id="class-code-input" placeholder="Enter class code">

    <label for="class-section-select">Select Section</label>
    <select id="class-section-select">
      <option value="">Select a section…</option>
    </select>

    <div class="btn-row">
      <button id="cancel-join" class="btn-cancel">Cancel</button>
      <button id="confirm-join" class="btn-join">Join</button>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/dashboard_student.js') }}"></script>
{% endblock %}
